<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Eduzz - Valor L√≠quido</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }

        input:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .btn {
            width: 100%;
            background: #4CAF50;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
        }

        .btn:hover {
            background: #45a049;
        }

        .resultado {
            background: #f8f9fa;
            border: 3px solid #4CAF50;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            display: none;
        }

        .resultado h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .linha-resultado {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .linha-resultado:last-child {
            border-bottom: 3px solid #4CAF50;
            font-weight: bold;
            font-size: 18px;
            color: #4CAF50;
            margin-top: 10px;
            padding-top: 15px;
        }

        .erro {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        #aliquotaGroup, #parcelasGroup, #metodoJurosGroup, #taxaJurosGroup, #taxaCustomGroup {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Calculadora Eduzz</h1>
        <p class="subtitle">Calcule o valor l√≠quido do produtor</p>

        <div class="info">
            <strong>üìå Taxas Eduzz:</strong><br>
            ‚Ä¢ Venda Direta: 4,90% + R$ 2,49<br>
            ‚Ä¢ Com Afiliado: 8,90% + R$ 2,49<br>
            ‚Ä¢ Taxa de Saque: R$ 9,00 (opcional)<br>
            ‚Ä¢ Juros Parcelamento: 3,29% ao m√™s
        </div>

        <div id="erro" class="erro"></div>

        <div class="form-group">
            <label>üíµ Valor da Venda (R$)</label>
            <input type="text" id="valor" placeholder="Ex: 100,50 ou 297,90">
        </div>

        <div class="form-group">
            <label>ü§ù Tipo de Venda</label>
            <select id="tipo">
                <option value="">Selecione...</option>
                <option value="direta">Venda Direta (4,90% + R$ 2,49)</option>
                <option value="afiliado">Com Afiliado (8,90% + R$ 2,49)</option>
            </select>
        </div>

        <div class="form-group">
            <label>üë§ Tipo de Pessoa</label>
            <select id="pessoa" onchange="mostrarImpostos()">
                <option value="">Selecione...</option>
                <option value="pf">Pessoa F√≠sica</option>
                <option value="pj">Pessoa Jur√≠dica (Simples Nacional)</option>
            </select>
        </div>

        <div class="form-group" id="aliquotaGroup">
            <label>üìä Al√≠quota de Imposto</label>
            <select id="imposto">
                <option value="">Selecione...</option>
            </select>
        </div>

        <div class="form-group">
            <label>üí≥ Incluir Taxa de Saque?</label>
            <select id="saque">
                <option value="nao">N√£o</option>
                <option value="sim">Sim (R$ 9,00)</option>
            </select>
        </div>

        <div class="form-group">
            <label>üí∞ Forma de Pagamento</label>
            <select id="pagamento" onchange="mostrarParcelas()">
                <option value="avista">√Ä Vista</option>
                <option value="parcelado">Parcelado (com juros)</option>
            </select>
        </div>

        <div class="form-group" id="parcelasGroup" style="display: none;">
            <label>üî¢ N√∫mero de Parcelas</label>
            <select id="parcelas">
                <option value="1">1x (sem juros)</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="7">7x</option>
                <option value="8">8x</option>
                <option value="9">9x</option>
                <option value="10">10x</option>
                <option value="11">11x</option>
                <option value="12">12x</option>
            </select>
        </div>

        <div class="form-group" id="metodoJurosGroup" style="display: none;">
            <label>üßÆ M√©todo de C√°lculo dos Juros</label>
            <select id="metodoJuros">
                <option value="tabela-price">Tabela Price - Parcelas Fixas (Eduzz/Kiwify)</option>
                <option value="juros-simples">Juros Simples - Linear (Antigo)</option>
            </select>
        </div>

        <div class="form-group" id="taxaJurosGroup" style="display: none;">
            <label>üìä Taxa de Juros Mensal</label>
            <select id="taxaJuros">
                <option value="2.92">2,92% a.m. (Eduzz produtos antigos)</option>
                <option value="3.29">3,29% a.m. (Eduzz padr√£o atual)</option>
                <option value="3.49">3,49% a.m. (Kiwify)</option>
                <option value="custom">Personalizada</option>
            </select>
        </div>

        <div class="form-group" id="taxaCustomGroup" style="display: none;">
            <label>üéØ Taxa Personalizada (%)</label>
            <input type="text" id="taxaCustom" placeholder="Ex: 2.5">
        </div>

        <button class="btn" onclick="calcularAgora()">üßÆ CALCULAR VALOR L√çQUIDO</button>

        <div id="resultado" class="resultado">
            <h3>üìã Resultado do C√°lculo</h3>
            <div id="linhas"></div>
        </div>
    </div>

    <script>
        function mostrarParcelas() {
            const pagamento = document.getElementById('pagamento').value;
            const parcelasGroup = document.getElementById('parcelasGroup');
            const metodoGroup = document.getElementById('metodoJurosGroup');
            const taxaGroup = document.getElementById('taxaJurosGroup');
            
            if (pagamento === 'parcelado') {
                parcelasGroup.style.display = 'block';
                metodoGroup.style.display = 'block';
                taxaGroup.style.display = 'block';
            } else {
                parcelasGroup.style.display = 'none';
                metodoGroup.style.display = 'none';
                taxaGroup.style.display = 'none';
                document.getElementById('taxaCustomGroup').style.display = 'none';
            }
        }

        // Mostrar campo de taxa personalizada
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('taxaJuros').addEventListener('change', function() {
                const customGroup = document.getElementById('taxaCustomGroup');
                if (this.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
            });
        });

        function mostrarImpostos() {
            const pessoa = document.getElementById('pessoa').value;
            const grupo = document.getElementById('aliquotaGroup');
            const select = document.getElementById('imposto');
            
            select.innerHTML = '<option value="">Selecione...</option>';
            
            if (pessoa === 'pf') {
                grupo.style.display = 'block';
                select.innerHTML += `
                    <option value="0">Isento (at√© R$ 2.112/m√™s)</option>
                    <option value="7.5">7,5% (R$ 2.112,01 a R$ 2.826,65)</option>
                    <option value="15">15% (R$ 2.826,66 a R$ 3.751,05)</option>
                    <option value="22.5">22,5% (R$ 3.751,06 a R$ 4.664,68)</option>
                    <option value="27.5">27,5% (acima de R$ 4.664,68)</option>
                `;
            } else if (pessoa === 'pj') {
                grupo.style.display = 'block';
                select.innerHTML += `
                    <option value="6">6% (at√© R$ 180.000/ano)</option>
                    <option value="9">9% (R$ 180.001 a R$ 360.000)</option>
                    <option value="10.2">10,2% (R$ 360.001 a R$ 720.000)</option>
                    <option value="14">14% (R$ 720.001 a R$ 1.800.000)</option>
                    <option value="22">22% (R$ 1.800.001 a R$ 3.600.000)</option>
                    <option value="33">33% (acima de R$ 3.600.000)</option>
                `;
            } else {
                grupo.style.display = 'none';
            }
        }

        function mostrarErro(mensagem) {
            const erro = document.getElementById('erro');
            erro.textContent = mensagem;
            erro.style.display = 'block';
            setTimeout(() => {
                erro.style.display = 'none';
            }, 5000);
        }

        function formatarMoeda(valor) {
            return valor.toFixed(2).replace('.', ',');
        }

        function converterValor(texto) {
            if (!texto) return 0;
            return parseFloat(texto.replace(',', '.')) || 0;
        }

        function calcularAgora() {
            // Pegar valores
            const valorTexto = document.getElementById('valor').value.trim();
            const tipo = document.getElementById('tipo').value;
            const pessoa = document.getElementById('pessoa').value;
            const impostoTexto = document.getElementById('imposto').value;
            const saque = document.getElementById('saque').value;
            const pagamento = document.getElementById('pagamento').value;
            const parcelas = document.getElementById('parcelas').value;
            const metodoJuros = document.getElementById('metodoJuros').value;
            const taxaJurosSelect = document.getElementById('taxaJuros').value;
            const taxaCustom = document.getElementById('taxaCustom').value;

            // Validar
            if (!valorTexto) {
                mostrarErro('‚ùå Digite o valor da venda');
                return;
            }
            if (!tipo) {
                mostrarErro('‚ùå Selecione o tipo de venda');
                return;
            }
            if (!pessoa) {
                mostrarErro('‚ùå Selecione o tipo de pessoa');
                return;
            }

            // Converter valores
            const valorVenda = converterValor(valorTexto);
            const aliquotaImposto = impostoTexto ? parseFloat(impostoTexto) : 0;
            const numParcelas = parseInt(parcelas) || 1;

            if (valorVenda <= 0) {
                mostrarErro('‚ùå Valor da venda deve ser maior que zero');
                return;
            }

            // Determinar taxa de juros
            let taxaJuros = 0;
            if (pagamento === 'parcelado' && numParcelas > 1) {
                if (taxaJurosSelect === 'custom') {
                    taxaJuros = parseFloat(taxaCustom) / 100 || 0;
                } else {
                    taxaJuros = parseFloat(taxaJurosSelect) / 100;
                }
            }

            // Calcular valor com juros se parcelado
            let valorFinalVenda = valorVenda;
            let valorJuros = 0;
            
            if (pagamento === 'parcelado' && numParcelas > 1) {
                if (metodoJuros === 'tabela-price') {
                    // Tabela Price: PMT = PV √ó [i √ó (1+i)^n] / [(1+i)^n - 1]
                    const pmt = valorVenda * (taxaJuros * Math.pow(1 + taxaJuros, numParcelas)) / (Math.pow(1 + taxaJuros, numParcelas) - 1);
                    valorFinalVenda = pmt * numParcelas;
                    valorJuros = valorFinalVenda - valorVenda;
                } else {
                    // Juros simples: Valor Original √ó Taxa √ó Parcelas
                    valorJuros = valorVenda * taxaJuros * numParcelas;
                    valorFinalVenda = valorVenda + valorJuros;
                }
            }

            // Calcular Eduzz e valor l√≠quido
            let percentual, fixo;
            if (tipo === 'direta') {
                percentual = 4.90;
                fixo = 2.49;
            } else {
                percentual = 8.90;
                fixo = 2.49;
            }

            // Taxa Eduzz calculada sobre valor ORIGINAL (juros ficam para a plataforma)
            const taxaEduzz = (valorVenda * percentual / 100) + fixo;
            
            // Impostos sobre valor TOTAL da venda (faturamento)
            const valorImposto = valorFinalVenda * aliquotaImposto / 100;
            
            const taxaSaque = saque === 'sim' ? 9.00 : 0;
            
            // Valor l√≠quido baseado no valor ORIGINAL (produtor n√£o recebe os juros)
            const valorLiquido = valorVenda - taxaEduzz - valorImposto - taxaSaque;

            // Montar resultado
            let html = `
                <div class="linha-resultado">
                    <span>üí∞ Valor Original do Produto:</span>
                    <span>R$ ${formatarMoeda(valorVenda)}</span>
                </div>
            `;

            if (pagamento === 'parcelado' && numParcelas > 1) {
                const valorParcela = valorFinalVenda / numParcelas;
                const metodoTexto = metodoJuros === 'tabela-price' ? 'Tabela Price' : 'Juros Simples';
                const taxaTexto = (taxaJuros * 100).toFixed(2);
                
                html += `
                    <div class="linha-resultado">
                        <span>üìà M√©todo: ${metodoTexto} (${taxaTexto}% a.m.):</span>
                        <span>+ R$ ${formatarMoeda(valorJuros)}</span>
                    </div>
                    <div class="linha-resultado">
                        <span>üíµ Valor Total (${numParcelas}x de R$ ${formatarMoeda(valorParcela)}):</span>
                        <span>R$ ${formatarMoeda(valorFinalVenda)}</span>
                    </div>
                    <div class="linha-resultado" style="font-style: italic; color: #666;">
                        <span>üí° Juros ficam para a plataforma</span>
                        <span></span>
                    </div>
                `;
            }

            html += `
                <div class="linha-resultado">
                    <span>üè¢ Taxa Eduzz (${percentual}% + R$ ${formatarMoeda(fixo)}) sobre valor original:</span>
                    <span>- R$ ${formatarMoeda(taxaEduzz)}</span>
                </div>
                <div class="linha-resultado">
                    <span>üìä Impostos (${aliquotaImposto}% sobre valor total):</span>
                    <span>- R$ ${formatarMoeda(valorImposto)}</span>
                </div>
            `;

            if (taxaSaque > 0) {
                html += `
                    <div class="linha-resultado">
                        <span>üí≥ Taxa de Saque:</span>
                        <span>- R$ ${formatarMoeda(taxaSaque)}</span>
                    </div>
                `;
            }

            // Calcular percentual l√≠quido (baseado no valor que o produtor efetivamente recebe)
            const percentualLiquido = (valorLiquido / valorVenda * 100).toFixed(1);
            const totalDescontos = taxaEduzz + valorImposto + taxaSaque;

            html += `
                <div class="linha-resultado">
                    <span>üíµ VALOR L√çQUIDO:</span>
                    <span>R$ ${formatarMoeda(valorLiquido)}</span>
                </div>
            `;

            // Adicionar informa√ß√µes extras
            html += `
                <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #4CAF50;">
                    <div class="linha-resultado" style="border: none; color: #333;">
                        <span>üìà <strong>Margem de Lucro L√≠quida:</strong></span>
                        <span><strong>${percentualLiquido.replace('.', ',')}%</strong></span>
                    </div>
                    <div class="linha-resultado" style="border: none; color: #666; font-size: 14px;">
                        <span>üìâ Total de Descontos:</span>
                        <span>R$ ${formatarMoeda(totalDescontos)}</span>
                    </div>
                </div>
            `;

            // Exibir
            document.getElementById('linhas').innerHTML = html;
            document.getElementById('resultado').style.display = 'block';

            // Rolar para resultado
            document.getElementById('resultado').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Permitir apenas n√∫meros, v√≠rgula e ponto no campo valor
        document.getElementById('valor').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^\d,\.]/g, '');
        });
    </script>
</body>
</html>